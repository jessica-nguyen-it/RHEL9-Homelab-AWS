# Bonus Log: I Forgot to Format My EBS Volumes üêß

Today I set out to practice disk backup and restoration using the `dd` command. Then, I remembered I had never formatted the volumes I attached to my EC2 instance. So, here‚Äôs a quick walkthrough of how I did that!

## üîç Spotting the Problem

I ran `df -h` and noticed only the root volume and its boot partitions were mounted. My two additional EBS volumes were nowhere to be seen:

```bash
[ec2-user@ip-xxx-xxx-xxx-xxx ~]$ df -h
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        4.0M     0  4.0M   0% /dev
tmpfs           359M   84K  359M   1% /dev/shm
tmpfs           144M  2.9M  141M   3% /run
efivarfs        128K  4.4K  119K   4% /sys/firmware/efi/efivars
/dev/nvme0n1p4   19G  3.3G   16G  18% /
/dev/nvme0n1p3  960M  324M  637M  34% /boot
/dev/nvme0n1p2  200M  7.1M  193M   4% /boot/efi
tmpfs            72M     0   72M   0% /run/user/1000
```

Then I ran `lsblk` to confirm the volumes were there but unmounted:

```bash
[ec2-user@ip-xxx-xxx-xxx-xxx ~]$ lsblk
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
nvme0n1     259:0    0   20G  0 disk
‚îú‚îÄnvme0n1p1 259:1    0    1M  0 part
‚îú‚îÄnvme0n1p2 259:2    0  200M  0 part /boot/efi
‚îú‚îÄnvme0n1p3 259:3    0    1G  0 part /boot
‚îî‚îÄnvme0n1p4 259:4    0 18.8G  0 part /
nvme1n1     259:5    0    5G  0 disk
nvme2n1     259:6    0    5G  0 disk
```

Finally to triple-check, I used `file -s` and confirmed they were raw:

```bash
[ec2-user@ip-xxx-xxx-xxx-xxx ~]$ sudo file -s /dev/nvme1n1
/dev/nvme1n1: data
```

## üõ†Ô∏è Step-by-Step Fix

Before I could begin working with `dd` and `rsync` for disk backup and restoration, I needed to ensure the EBS volumes were properly set up. That meant formatting them, creating mount points, and verifying they were ready to store data. Without that foundation, there‚Äôs nowhere for the backup or sync operations to go. 

Here‚Äôs how I did that!

### 1. Formatting the Volumes

```bash  
sudo mkfs.xfs /dev/nvme1n1  
sudo mkfs.xfs /dev/nvme2n1  
```

Check that the filesystems are now recognized:

```bash  
[ec2-user@ip-xxx-xxx-xxx-xxx ~]$ lsblk -f  
NAME        FSTYPE FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS
nvme0n1
‚îú‚îÄnvme0n1p1
‚îú‚îÄnvme0n1p2 vfat   FAT16       7B77-95E7                             192.7M     4% /boot/efi
‚îú‚îÄnvme0n1p3 xfs          boot  27bfefa8-69e7-41ce-a184-c487d56cac49  636.8M    34% /boot
‚îî‚îÄnvme0n1p4 xfs          root  b838f0f7-0240-46ea-bf53-c811361cbe43   15.5G    17% /
nvme1n1     xfs                8552178a-d912-4c4b-9c3d-c07da8120eb3    4.9G     1% /mnt/vol1
nvme2n1     xfs                9e3da813-ccfa-4da6-939a-0ff850af9e67    4.9G     1% /mnt/vol2  
```

### 2. Creating Mount Points

```bash  
sudo mkdir /mnt/vol1  
sudo mkdir /mnt/vol2  
```

### 3. Mounting the Volumes

```bash  
sudo mount /dev/nvme1n1 /mnt/vol1  
sudo mount /dev/nvme2n1 /mnt/vol2  
```

### 4. Verifying my Configurations

```bash  
[ec2-user@ip-xxx-xxx-xxx-xxx ~]$ df -h  
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        4.0M     0  4.0M   0% /dev
tmpfs           359M   84K  359M   1% /dev/shm
tmpfs           144M  2.9M  141M   3% /run
efivarfs        128K  4.4K  119K   4% /sys/firmware/efi/efivars
/dev/nvme0n1p4   19G  3.3G   16G  18% /
/dev/nvme0n1p3  960M  324M  637M  34% /boot
/dev/nvme0n1p2  200M  7.1M  193M   4% /boot/efi
tmpfs            72M     0   72M   0% /run/user/1000
/dev/nvme1n1    5.0G   68M  4.9G   2% /mnt/vol1
/dev/nvme2n1    5.0G   68M  4.9G   2% /mnt/vol2
```

Done!! (Just kidding)

## Footnote from the Future üò∏

One thing I didn‚Äôt realize at first is that although EBS volumes are persistent, they don‚Äôt automatically mount back into the filesystem on boot. This is a bit of an issue because after I finish practicing, I always shut down my instance to save money.

So first, I ran `lsblk -f` to get the UUID of the volume I wanted to mount as well as its filesystem type. As you can see, both `nvme0n1` and `nvme2n1` were unmounted.

```bash
[ec2-user@ip-xxx-xxx-xxx-xxx ~]$ lsblk -f
NAME        FSTYPE FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS
nvme1n1
‚îú‚îÄnvme1n1p1
‚îú‚îÄnvme1n1p2 vfat   FAT16       7B77-95E7                             192.7M     4% /boot/efi
‚îú‚îÄnvme1n1p3 xfs          boot  27bfefa8-69e7-41ce-a184-c487d56cac49  636.8M    34% /boot
‚îî‚îÄnvme1n1p4 xfs          root  b838f0f7-0240-46ea-bf53-c811361cbe43   15.5G    17% /
nvme0n1     xfs                8552178a-d912-4c4b-9c3d-c07da8120eb3    
nvme2n1     xfs                9e3da813-ccfa-4da6-939a-0ff850af9e67
```

Today I‚Äôll just focus on configuring `nvme0n1`, since I want to use it to store the backup files generated by my Week 3 script. I also renamed the `/mnt/vol1` directory to `/mnt/backups` for better clarity when navigating the filesystem.

So, I used the vi text editor to add the following line to the `/etc/fstab` configuration file. This entry tells Linux to mount the XFS partition with `UUID 8552178a-d912-4c4b-9c3d-c07da8120eb3` at `/mnt/backups` during boot, using default mount options. The `nofail` option ensures the system will still boot if the drive isn‚Äôt present, 0 disables dump backups, and 2 specifies that fsck should check this filesystem after the root filesystem.

```bash 
UUID=8552178a-d912-4c4b-9c3d-c07da8120eb3       /mnt/backups    xfs     defaults,nofail 0       2
```

After rebooting, you can see that everything is properly configured!

```bash
[ec2-user@ip-xxx-xxx-xxx-xxx ~]$ lsblk -f
NAME        FSTYPE FSVER LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINTS
nvme1n1
‚îú‚îÄnvme1n1p1
‚îú‚îÄnvme1n1p2 vfat   FAT16       7B77-95E7                             192.7M     4% /boot/efi
‚îú‚îÄnvme1n1p3 xfs          boot  27bfefa8-69e7-41ce-a184-c487d56cac49  636.8M    34% /boot
‚îî‚îÄnvme1n1p4 xfs          root  b838f0f7-0240-46ea-bf53-c811361cbe43   15.5G    17% /
nvme0n1     xfs                8552178a-d912-4c4b-9c3d-c07da8120eb3    4.9G     1% /mnt/backups
nvme2n1     xfs                9e3da813-ccfa-4da6-939a-0ff850af9e67
```

Boom. Mounted and ready to go!

